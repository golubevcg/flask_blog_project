"""Initial migration

Revision ID: 26813cecf850
Revises: 
Create Date: 2021-12-13 23:32:50.169511

"""
from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision = '26813cecf850'
down_revision = None
branch_labels = None
depends_on = None


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    posts_table = op.create_table('posts',
        sa.Column('id', sa.Integer(), nullable=False),
        sa.Column('header', sa.String(), nullable=False),
        sa.Column('body', sa.Text(), nullable=False),
        sa.Column('creation_date', sa.DateTime(), server_default=sa.text('now()'), nullable=False),
        sa.Column('is_published', sa.Boolean(), nullable=False),
        sa.Column('is_link_access', sa.Boolean(), nullable=False),
        sa.Column('is_deleted', sa.Boolean(), nullable=False),
        sa.PrimaryKeyConstraint('id'),
        sa.UniqueConstraint('header')
        )
    users_table = op.create_table('users',
        sa.Column('id', sa.Integer(), nullable=False),
        sa.Column('login', sa.String(), nullable=False),
        sa.Column('password', sa.String(), nullable=False),
        sa.Column('registration_date', sa.DateTime(), server_default=sa.text('now()'), nullable=False),
        sa.Column('is_deleted', sa.Boolean(), nullable=False),
        sa.PrimaryKeyConstraint('id'),
        sa.UniqueConstraint('login')
        )

    # ### end Alembic commands ###

    # seeding data
    # sql_posts_init = open("db_seed_sql_scripts/init_posts.sql")
    # op.execute(sql_posts_init.read())
    # sql_posts_init.close()
    #
    # sql_users_init = open("db_seed_sql_scripts/init_users.sql")
    # op.execute(sql_users_init.read())
    # sql_users_init.close()

    op.bulk_insert(
        users_table,
        [
            {"login": "admin",
             "password": '78bba5e38bacdee73bd20dd60d9cd47a',
             'is_deleted': False}
        ]
    )

    post_body = """
    {"ops": [{"insert": "Quill is a free, "}, {"attributes": {"color": "#0066cc", "background": "transparent", "link": "https://github.com/quilljs/quill/"}, "insert": "open source"}, {"insert": " WYSIWYG editor built for the modern web. With its "}, {"attributes": {"color": "#0066cc", "background": "transparent", "link": "https://quilljs.com/docs/modules/"}, "insert": "modular architecture"}, {"insert": " and expressive "}, {"attributes": {"color": "#0066cc", "background": "transparent", "link": "https://quilljs.com/docs/api/"}, "insert": "API"}, {"insert": ", it is completely customizable to fit any need.\n\n"}, {"attributes": {"height": "280", "width": "500", "align": "center"}, "insert": {"video": "https://player.vimeo.com/video/253905163"}}, {"insert": "\nGetting Started is Easy"}, {"attributes": {"align": "center", "header": 2}, "insert": "\n"}, {"insert": "\n// <link href=\"https://cdn.quilljs.com/1.2.6/quill.snow.css\" rel=\"stylesheet\">"}, {"attributes": {"code-block": true}, "insert": "\n"}, {"insert": "// <script src=\"https://cdn.quilljs.com/1.2.6/quill.min.js\"></script>"}, {"attributes": {"code-block": true}, "insert": "\n\n"}, {"insert": "var quill = new Quill('#editor', {"}, {"attributes": {"code-block": true}, "insert": "\n"}, {"insert": " modules: {"}, {"attributes": {"code-block": true}, "insert": "\n"}, {"insert": " toolbar: '#toolbar"}, {"attributes": {"code-block": true}, "insert": "\n\n"}, {"insert": " },"}, {"attributes": {"code-block": true}, "insert": "\n"}, {"insert": " theme: 'snow"}, {"attributes": {"code-block": true}, "insert": "\n"}, {"insert": "'});"}, {"attributes": {"code-block": true}, "insert": "\n"}, {"insert": "// Open your browser's developer console to try out the API!"}, {"attributes": {"code-block": true}, "insert": "\n"}, {"insert": "\n\n\n\n\n\nGianni Schicchi (Italian pronunciation: [\u02c8d\u0292anni \u02c8skikki]) is a comic opera in one act by Giacomo Puccini to an Italian libretto by Giovacchino Forzano, composed in 1917\u201318. The libretto is based on an incident mentioned in Dante's Divine Comedy. The work is the third and final part of Puccini's Il trittico (The Triptych) \u2013 three one-act operas with contrasting themes, originally written to be presented together. Although it continues to be performed with one or both of the other trittico operas, Gianni Schicchi is now more frequently staged either alone or with short operas by other composers. The aria \"O mio babbino caro\" is one of Puccini's best known, and one of the most popular arias in opera.\n\nPuccini had long considered writing a set of one-act operas which would be performed together in a single evening, but faced with a lack of suitable subjects and opposition from his publisher, he repeatedly put the project aside. However, by 1916 Puccini had completed the one-act tragedy Il tabarro and, after considering various ideas, he began work the following year on the solemn, religious, all-female opera Suor Angelica. Gianni Schicchi, a comedy, completes the triptych with a further contrast of mood. The score combines elements of Puccini's modern style of harmonic dissonance with lyrical passages reminiscent of Rossini, and it has been praised for its inventiveness and imagination.\n\nWhen Il trittico premiered at New York's Metropolitan Opera in December 1918, Gianni Schicchi became an immediate hit, while the other two operas were received with less enthusiasm. This pattern was broadly repeated at the Rome and London premieres and led to commercial pressures to abandon the less successful elements. Although on artistic grounds Puccini opposed performing the three operas except as the original triptych, by 1920 he had given his reluctant consent to separate performances. Gianni Schicchi has subsequently become the most-performed part of Il trittico and has been widely recorded.\n"}]}"""

    op.bulk_insert(
        posts_table,
        [
            {"header": "Quill Rich Text Editor",
             "body": post_body,
             'is_published': True,
             'is_link_access': False,
             'is_deleted': False}
        ]
    )


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_table('users')
    op.drop_table('posts')
    # ### end Alembic commands ###
